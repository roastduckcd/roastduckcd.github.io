<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<!-- coding百度验证 -->
<meta name="baidu-site-verification" content="SjtXCxQWOd">
<!-- 个人域名百度验证 -->
<meta name="baidu-site-verification" content="TFmrmKi4uB">
<!-- github Google验证 -->
<meta name="google-site-verification" content="hYqx1rSMO38c9cDs_PiE1zWzjtVPBuqdZZPtMnuOHrc">
<!-- 个人域名 Google验证 -->
<meta name="google-site-verification" content="tVCh-si3HbVcbGa9jP_lMVTEu4Ps0f9HoNrEWwom5tY">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-fill-left.min.css?v=1.0.2">

















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/roastduck32x32.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/roastduck16x16.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  





  <meta name="description" content="渲染架构The architecture of OpenGL is based on a client-server model. An application program written to use the OpenGL API is the “client” and runs on the CPU. The implementation of the OpenGL graphics en">
<meta name="keywords" content="固定管线,OpenGL,渲染架构,着色器">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenGL学习之路3-渲染架构及固定管线着色器">
<meta property="og:url" content="http://roastduck.xyz/article/OpenGL学习之路3-渲染架构及固定管线着色器.html">
<meta property="og:site_name" content="烤鸭的小火炉">
<meta property="og:description" content="渲染架构The architecture of OpenGL is based on a client-server model. An application program written to use the OpenGL API is the “client” and runs on the CPU. The implementation of the OpenGL graphics en">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.loli.net/2019/05/23/5ce692588029821818.jpg">
<meta property="og:updated_time" content="2019-07-15T11:16:18.538Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenGL学习之路3-渲染架构及固定管线着色器">
<meta name="twitter:description" content="渲染架构The architecture of OpenGL is based on a client-server model. An application program written to use the OpenGL API is the “client” and runs on the CPU. The implementation of the OpenGL graphics en">
<meta name="twitter:image" content="https://i.loli.net/2019/05/23/5ce692588029821818.jpg">






  <link rel="canonical" href="http://roastduck.xyz/article/OpenGL学习之路3-渲染架构及固定管线着色器.html">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>OpenGL学习之路3-渲染架构及固定管线着色器 | 烤鸭的小火炉</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/roastduckcd" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#FB6D6F; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">烤鸭的小火炉</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">一只喜欢看布袋戏的烤鸭</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-gossip">

    
    
    
      
    

    

    <a href="/categories/gossip" rel="section"><i class="menu-item-icon fa fa-fw fa-coffee"></i> <br>随笔</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://roastduck.xyz/article/OpenGL学习之路3-渲染架构及固定管线着色器.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阳仔">
      <meta itemprop="description" content="蹉跎错,消磨过,最是光阴化浮沫">
      <meta itemprop="image" content="/jianxiu.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="烤鸭的小火炉">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">OpenGL学习之路3-渲染架构及固定管线着色器

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-23 20:31:21" itemprop="dateCreated datePublished" datetime="2019-05-23T20:31:21+00:00">2019-05-23</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/图形处理/" itemprop="url" rel="index"><span itemprop="name">图形处理</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/图形处理/OpenGL/" itemprop="url" rel="index"><span itemprop="name">OpenGL</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/article/OpenGL学习之路3-渲染架构及固定管线着色器.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/article/OpenGL学习之路3-渲染架构及固定管线着色器.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <span class="post-symbolscount">
              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">4.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">8 分钟</span>
              
            </span>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="渲染架构"><a href="#渲染架构" class="headerlink" title="渲染架构"></a>渲染架构</h3><blockquote><p>The architecture of OpenGL is based on a client-server model. An application program written to use the OpenGL API is the “client” and runs on the CPU. The implementation of the OpenGL graphics engine (including the GLSL shader programs you will write) is the “server” and runs on the GPU. Geometry and many other types of attributes are stored in buffers called Vertx Buffer Objects (or VBOs). These buffers are allocated on the GPU and filled by your CPU program.</p>
<p>OpenGL 是基于CS模型的架构。C端指的是使用了OpenGL API的应用程序，是运行在CPU上的。S端指的是OpenGL图形引擎的实现，包括自定义着色器，是运行在GPU上的。图形的几何数据等属性存储在顶点缓冲区对象（VBO）中。这些缓冲区存在于GPU上（显存）但是由CPU填充数据。</p>
<footer><strong>James R. Mille</strong><cite><a href="https://people.eecs.ku.edu/~jrmiller/Courses/OpenGL/Architecture.html" target="_blank" rel="noopener">CPU-GPU Cooperation</a></cite></footer></blockquote>
<a id="more"></a>
<p><img src="https://i.loli.net/2019/05/23/5ce692588029821818.jpg" alt="opengl_rendering_architecture"></p>
<ul>
<li><p>这里的客户端、服务端和网络请求中代表的实体不同，但是思想都一样。开发者调用相应OpenGL API。CPU执行API就相当于发送请求，请求的参数就是顶点、纹理等数据，这些数据一开始都在内存中，由CPU从内存写入显存缓冲区。服务端即GPU使用相应着色器对收到的数据进行处理，最后渲染到屏幕上或者传回内存。服务端中开发者能操作的是顶点和片元着色器，这两者计算由GPU完成。</p>
<ul>
<li><strong>Attributes:</strong> 属性<ul>
<li>通常存储一些经常发生变化的值，比如存储顶点坐标、颜色值、纹理坐标、光照、法线等属性。</li>
<li>属性值会应用到每一个顶点，通常使用4个元素来描述一个属性值。比如坐标（x,y,z,w），当然我们不一定4个元素都使用。缺省时，(x,y,z)默认为0，w默认为1，这种缺省方式对颜色值等其他属性一样存在。</li>
<li>属性值只能传到顶点着色器，不能直接传递到片元着色器。</li>
</ul>
</li>
<li><p><strong>Uniforms:</strong> 统一值</p>
<ul>
<li>通常存储一些要应用到所有属性的值。它可以改变，但是他的变化不是针对某一个属性，而是整个图形而言。比如图形旋转由图形顶点数据*旋转矩阵。顶点数据肯定很多，它们的旋转肯定都是一样的即都是乘以同一个旋转矩阵，这个旋转矩阵就可以使用Uniform来传递。类似的还有平移矩阵、缩放矩阵等。</li>
<li>这个过程一般发生在顶点着色器。</li>
<li>可以同时使用多个不同形式的统一值。比如同时对图形旋转和变换颜色。</li>
</ul>
</li>
<li><p><strong>Texture:</strong> 纹理值，即图片，需要使用位图。但是一般不会传递到顶点着色器，而是由片元着色器根据片元纹理坐标获取颜色。</p>
</li>
<li><strong>Position and Outs:</strong> 这两个都是渲染管线内部变量，开发者是不能干预的。可以不用管。<ul>
<li>它们同时在顶点着色器和片元着色器声明。作为顶点着色器的输出，其值可以是常量或片元之间的插值？。片元着色器中响应的输入变量会接收这两个值。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="渲染管线（流水线）一般流程"><a href="#渲染管线（流水线）一般流程" class="headerlink" title="渲染管线（流水线）一般流程"></a>渲染管线（流水线）一般流程</h3><ul>
<li>渲染管线的定义可以<a href="http://roastduck.xyz/article/OpenGL%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%E4%B8%80-%E9%83%A8%E5%88%86%E6%9C%AF%E8%AF%AD.html#pipeline-管线，渲染流水线">看这</a></li>
<li>在OpenGL进⾏绘制的时候，⾸先由顶点着⾊器对传入的顶点数据进行运算，对原始顶点附加纹理坐标、进行坐标变换等操作。顶点着色器输出的数据再通过图元装配，将顶点转换为基本图元。接着会对图元进行裁切，因为视口之外的数据没必要进行渲染。剩下的数据进行光栅化，以图元范围内的像素点进行映射，生成相应的片元。最后，将片元数据传⼊片元着⾊器中进行运算。片元着⾊器会对栅格化数据中的每一个像素进行运算，并决定像素的颜⾊和深度值。经深度、Alpha等测试后和帧缓冲区（屏幕缓冲区？）对应像素颜色进行混合，最后成像。</li>
<li><a href="https://blog.csdn.net/u014587123/article/details/80460758" target="_blank" rel="noopener">https://blog.csdn.net/u014587123/article/details/80460758</a></li>
<li><a href="http://www.cnblogs.com/liangliangh/p/4116164.html" target="_blank" rel="noopener">http://www.cnblogs.com/liangliangh/p/4116164.html</a></li>
</ul>
<h3 id="固定管线着色器"><a href="#固定管线着色器" class="headerlink" title="固定管线着色器"></a>固定管线着色器</h3><ul>
<li>可编程管线中我们可以自定义顶点着色器和片元着色器的实现方式。</li>
<li>固定管线则是使用参数指定系统着色器，下面这些着色器可以看成是系统实现好的顶点和片元着色器“组合”后的产物。</li>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_STOCK_SHADER nShaderID, ...)</span><br></pre></td></tr></table></figure>
</li>
<li><p>第一个参数为着色器类型，一共有10种着色器选项。每种着色器需要的参数个数是不一样的。</p>
</li>
</ul>
<h5 id="单元着色器-GLT-SHADER-IDENTITY"><a href="#单元着色器-GLT-SHADER-IDENTITY" class="headerlink" title="单元着色器 : GLT_SHADER_IDENTITY"></a>单元着色器 : <code>GLT_SHADER_IDENTITY</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_IDENTITY, GLfloat vColor[<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：一维RGBA颜色数组。</p>
</li>
<li>在默认坐标系（-1，1）中以指定颜色渲染图形。</li>
</ul>
<h5 id="平面着色器-GLT-SHADER-FLAT"><a href="#平面着色器-GLT-SHADER-FLAT" class="headerlink" title="平面着色器 : GLT_SHADER_FLAT"></a>平面着色器 : <code>GLT_SHADER_FLAT</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_FLAT, GLfloat mvp[<span class="number">16</span>], GLfloat vColor[<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4图形变换矩阵。</p>
</li>
<li>参数3：一维RGBA颜色数组。</li>
<li>渲染的图形需要应用旋转、平移等模型变换或者投影变换等矩阵。如果要同时应用两种变换，需要开发者自行计算两种变换矩阵的结果。</li>
</ul>
<h5 id="上色着色器-GLT-SHADER-SHADED"><a href="#上色着色器-GLT-SHADER-SHADED" class="headerlink" title="上色着色器 : GLT_SHADER_SHADED"></a>上色着色器 : <code>GLT_SHADER_SHADED</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_SHADED,GLfloat mvp[<span class="number">16</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4图形变换矩阵。</p>
</li>
<li>变换同平面着色器一样，不同的是会自动平滑着色。</li>
</ul>
<h5 id="默认光源着色器-GLT-SHADER-DEFAULT-LIGHT"><a href="#默认光源着色器-GLT-SHADER-DEFAULT-LIGHT" class="headerlink" title="默认光源着色器 : GLT_SHADER_DEFAULT_LIGHT"></a>默认光源着色器 : <code>GLT_SHADER_DEFAULT_LIGHT</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_DEFAULT_LIGHT, GLfloat mvMatrix[<span class="number">16</span>], GLfloat pMatrix[<span class="number">16</span>], GLfloat vColor[<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4模型变换矩阵。</p>
</li>
<li>参数3：4*4投影变换矩阵。</li>
<li>参数4：一维RGBA颜色数组。</li>
<li>默认光源模拟太阳光线，发出的是平行光。会使图形产生阴影和光照效果，参数2或参数3之一设置为单元矩阵，就同平面着色器一样。同时应用两种变换，不需要开发者单独计算。</li>
</ul>
<h5 id="点光源着色器-GLT-SHADER-POINT-LIGHT-DIFF"><a href="#点光源着色器-GLT-SHADER-POINT-LIGHT-DIFF" class="headerlink" title="点光源着色器 : GLT_SHADER_POINT_LIGHT_DIFF"></a>点光源着色器 : <code>GLT_SHADER_POINT_LIGHT_DIFF</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_POINT_LIGHT_DIEF, GLfloat mvMatrix[<span class="number">16</span>], GLfloat pMatrix[<span class="number">16</span>], GLfloat vLightPos[<span class="number">3</span>], GLfloat vColor[<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4模型变换矩阵。</p>
</li>
<li>参数3：4*4投影变换矩阵。</li>
<li>参数4：点光源位置(x,y,z)。</li>
<li>参数5：一维RGBA颜色数组，漫反射颜色。</li>
<li>变换同默认光源着色器类似，但是光源的位置是待定的。</li>
</ul>
<h5 id="纹理替换着色器-GLT-SHADER-TEXTURE-REPLACE"><a href="#纹理替换着色器-GLT-SHADER-TEXTURE-REPLACE" class="headerlink" title="纹理替换着色器 : GLT_SHADER_TEXTURE_REPLACE"></a>纹理替换着色器 : <code>GLT_SHADER_TEXTURE_REPLACE</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_TEXTURE_REPLACE, GLfloat mvMatrix[<span class="number">16</span>], GLint nTextureUnit);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4模型变换矩阵。</p>
</li>
<li>参数3：纹理单元。</li>
<li>可以对图形应用模型或投影变换（虽然参数是mv，但是投影变换也是16矩阵）。变换后的图形使用纹理单元进行颜色填充。</li>
</ul>
<h5 id="纹理调整着色器-GLT-SHADER-TEXTURE-MODULATE"><a href="#纹理调整着色器-GLT-SHADER-TEXTURE-MODULATE" class="headerlink" title="纹理调整着色器 : GLT_SHADER_TEXTURE_MODULATE"></a>纹理调整着色器 : <code>GLT_SHADER_TEXTURE_MODULATE</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_TEXTURE_MODULATE, GLfloat mvMatrix[<span class="number">16</span>], GLfloat vColor[<span class="number">4</span>], GLint nTextureUnit);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4模型变换矩阵。</p>
</li>
<li>参数3：一维RGBA颜色数组。</li>
<li>参数4：纹理单元。</li>
<li>可以对图形应用模型或投影变换（虽然参数是mv，但是投影变换也是16矩阵）。将参数3提供的颜色和纹理的颜色混合（相乘），变换后的图形使用混合色进行颜色填充。</li>
</ul>
<h5 id="纹理点光源着色器-GLT-SHADER-TEXTURE-POINT-LIGHT-DIFF"><a href="#纹理点光源着色器-GLT-SHADER-TEXTURE-POINT-LIGHT-DIFF" class="headerlink" title="纹理点光源着色器 : GLT_SHADER_TEXTURE_POINT_LIGHT_DIFF"></a>纹理点光源着色器 : <code>GLT_SHADER_TEXTURE_POINT_LIGHT_DIFF</code></h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_TEXTURE_POINT_LIGHT_DIFF, G Lfloat mvMatrix[<span class="number">16</span>], GLfloat pMatrix[<span class="number">16</span>], GLfloat vLightPos[<span class="number">3</span>], GLfloat vBaseColor[<span class="number">4</span>], GLint nTextureUnit);</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数2：4*4模型变换矩阵。</p>
</li>
<li>参数3：4*4投影变换矩阵。</li>
<li>参数4：点光源位置（x,y,z）。</li>
<li>参数5：一维RGBA颜色数组。</li>
<li>参数6：纹理单元。</li>
<li>可以对图形应用模型或投影变换。将参数5提供的颜色和纹理的颜色混合（相乘），变换后的图形使用混合色进行颜色填充，并且使用漫反射照明进行调整（矩阵相乘）。</li>
</ul>
<blockquote>
<p>以下两个暂未查到相关资料</p>
</blockquote>
<h5 id="着色器-GLT-SHADER-TEXTURE-RECT-REPLACE？"><a href="#着色器-GLT-SHADER-TEXTURE-RECT-REPLACE？" class="headerlink" title="着色器 : GLT_SHADER_TEXTURE_RECT_REPLACE？"></a>着色器 : <code>GLT_SHADER_TEXTURE_RECT_REPLACE</code>？</h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_TEXTURE_RECT_REPLACE, );</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="着色器-GLT-SHADER-LAST？"><a href="#着色器-GLT-SHADER-LAST？" class="headerlink" title="着色器 : GLT_SHADER_LAST？"></a>着色器 : <code>GLT_SHADER_LAST</code>？</h5><ul>
<li><p>函数原型</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLShaderManager::UseStockShader(GLT_SHADER_LAST, );</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    

    
    
    

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/article/OpenGL学习之路3-渲染架构及固定管线着色器.html">OpenGL学习之路3-渲染架构及固定管线着色器</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 阳仔 的个人博客">阳仔</a></p>
  <p><span>发布时间:</span>2019年05月23日 - 20:05</p>
  <p><span>最后更新:</span>2019年07月15日 - 11:07</p>
  <p><span>原始链接:</span><a href="/article/OpenGL学习之路3-渲染架构及固定管线着色器.html" title="OpenGL学习之路3-渲染架构及固定管线着色器">http://roastduck.xyz/article/OpenGL学习之路3-渲染架构及固定管线着色器.html</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://roastduck.xyz/article/OpenGL学习之路3-渲染架构及固定管线着色器.html" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
      });
    });  
</script>

      
    </div>
    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/固定管线/" rel="tag"><i class="fa fa-tags"></i> 固定管线</a>
          
            <a href="/tags/OpenGL/" rel="tag"><i class="fa fa-tags"></i> OpenGL</a>
          
            <a href="/tags/渲染架构/" rel="tag"><i class="fa fa-tags"></i> 渲染架构</a>
          
            <a href="/tags/着色器/" rel="tag"><i class="fa fa-tags"></i> 着色器</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/article/OpenGL学习之路1-部分术语.html" rel="next" title="OpenGL学习之路1-部分术语">
                <i class="fa fa-chevron-left"></i> OpenGL学习之路1-部分术语
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/article/OpenGL学习之路4-mac环境搭建及简单渲染.html" rel="prev" title="OpenGL学习之路4-mac环境搭建及简单渲染">
                OpenGL学习之路4-mac环境搭建及简单渲染 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/jianxiu.png" alt="阳仔">
            
              <p class="site-author-name" itemprop="name">阳仔</p>
              <p class="site-description motion-element" itemprop="description">蹉跎错,消磨过,最是光阴化浮沫</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">52</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">51</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/roastduckcd" title="GitHub &rarr; https://github.com/roastduckcd" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/8f6ea27db0c7" title="简书 &rarr; https://www.jianshu.com/u/8f6ea27db0c7" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>简书</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染架构"><span class="nav-text">渲染架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染管线（流水线）一般流程"><span class="nav-text">渲染管线（流水线）一般流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#固定管线着色器"><span class="nav-text">固定管线着色器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#单元着色器-GLT-SHADER-IDENTITY"><span class="nav-text">单元着色器 : GLT_SHADER_IDENTITY</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#平面着色器-GLT-SHADER-FLAT"><span class="nav-text">平面着色器 : GLT_SHADER_FLAT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#上色着色器-GLT-SHADER-SHADED"><span class="nav-text">上色着色器 : GLT_SHADER_SHADED</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#默认光源着色器-GLT-SHADER-DEFAULT-LIGHT"><span class="nav-text">默认光源着色器 : GLT_SHADER_DEFAULT_LIGHT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#点光源着色器-GLT-SHADER-POINT-LIGHT-DIFF"><span class="nav-text">点光源着色器 : GLT_SHADER_POINT_LIGHT_DIFF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#纹理替换着色器-GLT-SHADER-TEXTURE-REPLACE"><span class="nav-text">纹理替换着色器 : GLT_SHADER_TEXTURE_REPLACE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#纹理调整着色器-GLT-SHADER-TEXTURE-MODULATE"><span class="nav-text">纹理调整着色器 : GLT_SHADER_TEXTURE_MODULATE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#纹理点光源着色器-GLT-SHADER-TEXTURE-POINT-LIGHT-DIFF"><span class="nav-text">纹理点光源着色器 : GLT_SHADER_TEXTURE_POINT_LIGHT_DIFF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#着色器-GLT-SHADER-TEXTURE-RECT-REPLACE？"><span class="nav-text">着色器 : GLT_SHADER_TEXTURE_RECT_REPLACE？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#着色器-GLT-SHADER-LAST？"><span class="nav-text">着色器 : GLT_SHADER_LAST？</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阳仔</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">162k</span>
  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  

  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>







  






  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>




<script src="//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'Ck2z7fsTPsdmwBD4N3JjmNRG-gzGzoHsz',
    appKey: 'JXRAAfxGqYDsVLnOGO5Fcc4u',
    placeholder: '各位道友，请举手发言',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; 
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  <!-- 鼠标单击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  <!-- 点击窗口关闭侧边栏 -->
  <script type="text/javascript" src="/js/src/close-sidebar.js"></script>
  <!-- 百度分享 -->
  <!-- <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","qzone","sqq","tsina","bdysc","renren","tqq","bdxc","tieba","douban","ibaidu","youdao","sdo","mail","isohu","ty","fbook","twi","linkedin","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"4","bdPos":"right","bdTop":"101.28695678710938"},"image":{"viewList":["weixin","sqq","tsina","tqq","renren"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
  </script> -->
</body>
</html>
