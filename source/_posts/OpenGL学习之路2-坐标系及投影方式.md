---
title: OpenGL坐标系及投影方式
date: 2019-05-29 11:41:41
comments: true
toc: true
copyright: true
declare: true
top:
categories:
- 图形处理
- OpenGL
tags:
- 坐标系
- 投影和矩阵变换
---


### 坐标系
* [OpenGL: 你不知道的左右手坐标系](https://www.cnblogs.com/h2zZhou/p/5148487.html)
* OpenGL 中实际计算时使用的都是齐次坐标(x,y,z,w)，w 为缩放因子，通常为1。x,y,z值通过除以w，来进⾏行行缩放。
<!--more-->

#### 标准化设备坐标(normalized device coordinates NDC)也叫归一化坐标
* x,y,z范围为[-1,1]的坐标系。左手坐标系。 OpenGL 推荐使用NDC作为着色器数据，但是习惯上我们会自定义坐标范围。因此通常在顶点着色器中将坐标标准化，再进行下一步。

#### OpengGL坐标系
* 世界坐标系：以屏幕中心为原点，屏幕指向观察者为+Z 轴的右手坐标系。
* 物体坐标系（模型坐标系，绘图坐标系）：以物体某点为原点形成的三位直角坐标系。该坐标系与物体绑定，随物体变换而变换。不同物体有其自己的物体坐标系，并且相互独立。绘图刚开始，该坐标系和世界坐标系轴平行，但是经过变换后，物体坐标系将会变化。
* 惯性坐标系：以物体坐标系原点为原点，坐标轴平行于世界坐标系坐标轴的坐标系。该坐标系是为了简化世界和物体坐标系的变换。物体坐标系变换到惯性坐标系，由于共原点，只需要进行旋转；惯性坐标系到世界坐标系只需要平移。

#### 摄像机坐标系
* 以摄像机为原点，以摄像机观察方向为+Z，摄像机向上为+Y，向右为+X，采用左手坐标系。渲染管线会将世界坐标转换成摄像机坐标，裁减掉视景体以外的坐标，剩下的进入后续计算。该坐标系和屏幕坐标系类似，但是屏幕坐标系是二维的，摄像机坐标系是三维的。

#### 屏幕坐标系
* 屏幕的二维坐标系。iOS中视图的坐标系以左上角为原点，X轴向右、Y轴向下为正。macOS中视图以左下角为原点，X轴向右、Y轴向上为正。

### 投影方式
* 投影指的是将三维模型转换到二维视口的方式。
* 正交投影：类似于用一束平行光照射物体得到的投影，这种方式得到的投影不管离摄像机远近，都是等大的。
* 透视投影：类似于用点光源照射物体得到的投影，这种方式得到的投影离摄像机越远投影越小。透视投影符合真实世界人眼看物体，离眼睛越近物体的看上去越大。
    ![opengl_flat_perspective_projection](https://i.loli.net/2019/05/29/5cedff4b3803135022.jpg)
    * PQ 为我们观察结果所在的视平面。物体和摄像机连线在视平面相交于A、B两点，很明显AQ>BQ。这就是透视投影远小近大的原因。梯形PQNM或PQTR为可视区域，只有该区域内的模型能透视到视平面PQ。因此透视投影需要指定远、近裁剪面距离。
    * 实际投影是一个三维立体图形，该立体区域称为视锥体（视景体）。摄像机位于椎体顶点E，截面1被称为近裁剪面，截面2被称为远裁剪面。这两个平面之间的棱台即可视区域，凡是可视区域边界以外的模型都将被裁减掉。
        ![opengl_perspective_projection_frustum](https://i.loli.net/2019/05/29/5cedff4ae91f698906.jpg)
    * 透视投影的目的就是将裁减空间转换为标准化设备坐标。转换后，近裁剪面与XY轴平面平行，Z轴垂直于中心沿观察方向为正。x,y,z范围都是[-1,1]。
    * [透视投影原理和实现](https://blog.csdn.net/wong_judy/article/details/6283019)
    * [透视投影详解](https://www.cnblogs.com/graphics/archive/2012/07/25/2582119.html )透视投影目的部分，近裁剪面右上角应该映射到立方体右上角。

### 窗口、视口、裁减区域
* 窗口：系统提供的显示区域。
* 视口：窗口中实际用于显示图形的平面区域。使用`glViewPort(x,y,width,height)`指定，一般都将x,y设为0，即从原点开始的一块宽width，高height的区域。
* 裁减区域：远近裁剪面组成的一个几何棱台区域（透视投影）或长方体（正交投影），只有该区域内的模型会投影到屏幕。超出区域都将被裁减。
* 在窗口看到的渲染内容需要视口和裁减区域共同确定。把视口类比为摄像机镜头，它能拍到的是裁减区域内物体模型。
* 视口能看到整个裁减区域。视口看的是裁减区域，裁减区域放置模型，视口看到模型。
* [glViewport()函数和glOrtho()函数的理解](https://blog.csdn.net/ivan_ljf/article/details/8726672)

### 矩阵变换
* 参与变换的几个坐标系统
    * 局部空间(Local Space，Object Space)
    * 世界空间(World Space)
    * 摄像机空间(Camera Space，Eye Space，View Space)
    * 裁剪空间(Clip Space)
    * 屏幕空间(Screen Space)
* 3D模型坐标转换到屏幕2D坐标过程
    * 3位坐标变换是通过平移、旋转、缩放、反转这几个操作完成，我们将这几个动作综合成一个变换矩阵。三种坐标变换分别对应：模型矩阵、视图矩阵、投影矩阵。
    * 物体坐标 \* 模型变换矩阵 => 世界坐标 \* 视图(摄像机)变换矩阵 => 摄像机坐标 \* 投影矩阵 => 裁减坐标赋值给顶点着色器中的gl_Position变量，自动对裁减坐标做透视除法 => NDC 坐标，通过视口变换 => 屏幕坐标。这个过程都是在顶点着色器中完成。
        ![opengl_coordinate_transform_pipeline](https://i.loli.net/2019/05/29/5cedff4b1ff6461910.png)
    * 模型变换、视图变换和投影变换由开发者进行自定义；透视除法、视口变换则由OpenGL内部完成。
    * 用一个公式来标识物体坐标到裁减坐标。注意OpenGL矩阵乘法采用左乘（从右向左）法则。
        M<sub>clip</sub> = M<sub>proj</sub> · M<sub>view</sub> · M<sub>model</sub> · M<sub>local</sub>
* [OpeGL坐标系统](https://blog.csdn.net/LeonShaw_zh/article/details/84552418)
* [坐标变换原理](https://www.cnblogs.com/liangliangh/p/4089582.html) 
